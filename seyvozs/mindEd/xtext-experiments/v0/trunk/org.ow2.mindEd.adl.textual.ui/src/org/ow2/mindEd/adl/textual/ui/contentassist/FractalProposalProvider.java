/*
 * generated by Xtext
 */
package org.ow2.mindEd.adl.textual.ui.contentassist;

import org.eclipse.emf.ecore.EObject;
import org.eclipse.jface.text.contentassist.ICompletionProposal;
import org.eclipse.xtext.Assignment;
import org.eclipse.xtext.RuleCall;
import org.eclipse.xtext.ui.editor.contentassist.ContentAssistContext;
import org.eclipse.xtext.ui.editor.contentassist.ICompletionProposalAcceptor;
import org.ow2.mindEd.adl.textual.fractal.ArchitectureDefinition;
import org.ow2.mindEd.adl.textual.fractal.SubComponentDefinition;
import org.ow2.mindEd.adl.textual.ui.contentassist.AbstractFractalProposalProvider;
/**
 * see http://www.eclipse.org/Xtext/documentation/latest/xtext.html#contentAssist on how to customize content assistant
 */
public class FractalProposalProvider extends AbstractFractalProposalProvider {

	/**
	 * Content assist for sub-component (anonymous definition or instance) name.
	 * Default name is the same as the previously declared type, with first letter in lower case.
	 * 
	 * @see org.ow2.fractal.mind.xtext.contentassist.AbstractFractalProposalProvider#completeSubComponentDefinition_Name(
	 * 		org.ow2.mindEd.adl.textual.fractal.SubComponentDefinition,
	 *      org.eclipse.xtext.Assignment,
	 *      org.eclipse.xtext.ui.core.editor.contentassist.ContentAssistContext,
	 *      org.eclipse.xtext.ui.core.editor.contentassist.ICompletionProposalAcceptor)
	 * 
	 */
	public void completeSubComponentDefinition_Name(SubComponentDefinition subCompDef, Assignment assignment, ContentAssistContext context, ICompletionProposalAcceptor acceptor) {
		// Proposal to add for content assist
		String proposal = null;
		ICompletionProposal completionProposal = null;

		ArchitectureDefinition archDef = subCompDef.getType();
		String typeName = archDef.getName();

		// Filter the complete QualifiedName to keep only the last substring
		String simpleName = typeName.substring(typeName.lastIndexOf(".") + 1);

		proposal = simpleName.substring(0,1).toLowerCase().concat(simpleName.substring(1));

		completionProposal = createCompletionProposal(proposal, proposal + " - Instance name suggestion", null, context);
		acceptor.accept(completionProposal);
	}

	@Override
	public void complete_ID(EObject model, RuleCall ruleCall, final ContentAssistContext context,
			ICompletionProposalAcceptor acceptor) {

		if (model instanceof SubComponentDefinition)
			// Does nothing to disable default content assist for ID Role that would display "ID - Name" AND our suggestion
			return;
		else super.complete_ID(model, ruleCall, context, acceptor);
	}	
}
